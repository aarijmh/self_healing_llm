<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2P Protocol Security Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #2c3e50; margin-bottom: 10px; }
        .header p { color: #7f8c8d; font-size: 16px; }
        
        .phases { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .phase { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .phase h3 { color: #34495e; margin-bottom: 15px; display: flex; align-items: center; }
        .phase-number { background: #3498db; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-weight: bold; }
        .phase.completed .phase-number { background: #27ae60; }
        .phase.error .phase-number { background: #e74c3c; }
        
        .btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; margin: 5px; transition: all 0.3s; }
        .btn:hover { background: #2980b9; transform: translateY(-2px); }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; }
        .btn.danger { background: #e74c3c; }
        .btn.danger:hover { background: #c0392b; }
        
        .status { margin-top: 15px; padding: 10px; border-radius: 5px; font-size: 14px; }
        .status.success { background: #d5f4e6; color: #27ae60; border: 1px solid #27ae60; }
        .status.error { background: #fdf2f2; color: #e74c3c; border: 1px solid #e74c3c; }
        .status.info { background: #e8f4fd; color: #3498db; border: 1px solid #3498db; }
        
        .transaction-section { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .transaction-form { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .transaction-form input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        
        .attacks-section { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .attacks-section h3 { color: #e74c3c; margin-bottom: 15px; }
        
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .metric { background: #ecf0f1; padding: 15px; border-radius: 8px; text-align: center; }
        .metric-value { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .metric-label { font-size: 12px; color: #7f8c8d; margin-top: 5px; }
        
        .log { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 200px; overflow-y: auto; margin-top: 15px; }
        .log-entry { margin-bottom: 5px; }
        .log-success { color: #2ecc71; }
        .log-error { color: #e74c3c; }
        .log-info { color: #3498db; }
        
        .reset-btn { position: fixed; top: 20px; right: 20px; z-index: 1000; }
    </style>
</head>
<body>
    <button class="btn danger reset-btn" onclick="resetDemo()">üîÑ Reset Demo</button>
    
    <div class="container">
        <div class="header">
            <h1>üîê A2P Protocol Security Demo</h1>
            <p>Interactive demonstration of Agent-to-Payment Protocol with CallSign Gateway</p>
        </div>
        
        <div class="phases">
            <div class="phase" id="phase1">
                <h3><span class="phase-number">1</span>Merchant Registration</h3>
                <p>Register Amazon as a trusted merchant with the Agent Directory</p>
                <button class="btn" onclick="executePhase1()">Register Merchant</button>
                <div class="status" id="phase1-status" style="display: none;"></div>
            </div>
            
            <div class="phase" id="phase2">
                <h3><span class="phase-number">2</span>Agent Registration</h3>
                <p>Create and register an AI agent with shopping capabilities</p>
                <button class="btn" onclick="executePhase2()" disabled>Register Agent</button>
                <div class="status" id="phase2-status" style="display: none;"></div>
            </div>
            
            <div class="phase" id="phase3">
                <h3><span class="phase-number">3</span>User Setup</h3>
                <p>Establish user trust and set delegation limits</p>
                <button class="btn" onclick="executePhase3()" disabled>Setup User</button>
                <div class="status" id="phase3-status" style="display: none;"></div>
            </div>
        </div>
        
        <div class="transaction-section">
            <h3>üí≥ Process Transaction</h3>
            <div class="transaction-form">
                <input type="number" id="amount" placeholder="Amount ($)" min="1" max="5000" value="99">
                <input type="text" id="item" placeholder="Item name" value="Wireless Mouse">
                <button class="btn" onclick="processTransaction()" id="transaction-btn" disabled>Make Purchase</button>
            </div>
            <div class="status" id="transaction-status" style="display: none;"></div>
        </div>
        
        <div class="attacks-section">
            <h3>üö® Security Attack Simulations</h3>
            <p>Test the protocol's security by simulating various attack scenarios:</p>
            <div style="margin-top: 15px;">
                <button class="btn danger" onclick="attackMalicious()">Malicious Agent Attack</button>
                <button class="btn danger" onclick="attackExceedLimit()">Exceed Delegation Limit</button>
                <button class="btn danger" onclick="attackRevoke()">Use Revoked Certificate</button>
            </div>
            <div class="status" id="attack-status" style="display: none;"></div>
        </div>
        
        <div class="metrics">
            <div class="metric">
                <div class="metric-value" id="balance">$0</div>
                <div class="metric-label">Account Balance</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="spent">$0</div>
                <div class="metric-label">Total Spent</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="remaining">$0</div>
                <div class="metric-label">Delegation Remaining</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="agent-status">‚ùå</div>
                <div class="metric-label">Agent Status</div>
            </div>
        </div>
        
        <div class="log" id="log">
            <div class="log-entry log-info">üöÄ A2P Protocol Demo initialized. Start with Phase 1: Merchant Registration</div>
        </div>
    </div>

    <script>
        let currentPhase = 0;
        
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            logEl.innerHTML += `<div class="log-entry log-${type}">[${timestamp}] ${icon} ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function updateStatus(phaseId, message, type) {
            const statusEl = document.getElementById(`${phaseId}-status`);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }
        
        function updatePhase(phaseNum, completed = true, error = false) {
            const phase = document.getElementById(`phase${phaseNum}`);
            if (error) {
                phase.classList.add('error');
            } else if (completed) {
                phase.classList.add('completed');
                currentPhase = Math.max(currentPhase, phaseNum);
                
                // Enable next phase button
                if (phaseNum < 3) {
                    const nextBtn = document.querySelector(`#phase${phaseNum + 1} button`);
                    if (nextBtn) nextBtn.disabled = false;
                }
                
                // Enable transaction button after phase 3
                if (phaseNum === 3) {
                    document.getElementById('transaction-btn').disabled = false;
                }
            }
        }
        
        async function executePhase1() {
            log('Starting Phase 1: Merchant Registration...');
            try {
                const response = await fetch('/api/phase1', { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus('phase1', `‚úÖ Merchant registered: ${data.merchant_id}`, 'success');
                    updatePhase(1);
                    log(`Merchant ${data.merchant_id} registered successfully with certificate ${data.certificate_id}`, 'success');
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                updateStatus('phase1', `‚ùå Error: ${error.message}`, 'error');
                updatePhase(1, false, true);
                log(`Phase 1 failed: ${error.message}`, 'error');
            }
        }
        
        async function executePhase2() {
            log('Starting Phase 2: Agent Registration...');
            try {
                const response = await fetch('/api/phase2', { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus('phase2', `‚úÖ Agent registered: ${data.agent_id}`, 'success');
                    updatePhase(2);
                    log(`Agent ${data.agent_id} registered with capabilities: ${data.capabilities.join(', ')}`, 'success');
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                updateStatus('phase2', `‚ùå Error: ${error.message}`, 'error');
                updatePhase(2, false, true);
                log(`Phase 2 failed: ${error.message}`, 'error');
            }
        }
        
        async function executePhase3() {
            log('Starting Phase 3: User Setup and Trust Establishment...');
            try {
                const response = await fetch('/api/phase3', { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus('phase3', `‚úÖ User setup complete. Delegation limit: $${data.delegation_limit}`, 'success');
                    updatePhase(3);
                    log(`User ${data.user_id} setup complete with $${data.delegation_limit} delegation limit`, 'success');
                    updateMetrics();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                updateStatus('phase3', `‚ùå Error: ${error.message}`, 'error');
                updatePhase(3, false, true);
                log(`Phase 3 failed: ${error.message}`, 'error');
            }
        }
        
        async function processTransaction() {
            const amount = parseInt(document.getElementById('amount').value);
            const item = document.getElementById('item').value;
            
            log(`Processing transaction: ${item} for $${amount}...`);
            try {
                const response = await fetch('/api/transaction', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount, item })
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus('transaction', `‚úÖ Purchase successful! TX: ${data.tx_id}`, 'success');
                    log(`Transaction successful: ${item} purchased for $${amount} (TX: ${data.tx_id})`, 'success');
                    updateMetrics();
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                updateStatus('transaction', `‚ùå Transaction failed: ${error.message}`, 'error');
                log(`Transaction failed: ${error.message}`, 'error');
            }
        }
        
        async function attackMalicious() {
            log('üö® Simulating malicious agent attack...');
            try {
                const response = await fetch('/api/attack/malicious', { method: 'POST' });
                const data = await response.json();
                updateStatus('attack', `üõ°Ô∏è Attack blocked: ${data.message}`, 'success');
                log(`Malicious agent attack blocked: ${data.message}`, 'success');
            } catch (error) {
                log(`Attack simulation error: ${error.message}`, 'error');
            }
        }
        
        async function attackExceedLimit() {
            log('üö® Simulating delegation limit bypass attack...');
            try {
                const response = await fetch('/api/attack/exceed_limit', { method: 'POST' });
                const data = await response.json();
                updateStatus('attack', `üõ°Ô∏è Attack blocked: ${data.message}`, 'success');
                log(`Delegation limit attack blocked: ${data.message}`, 'success');
            } catch (error) {
                log(`Attack simulation error: ${error.message}`, 'error');
            }
        }
        
        async function attackRevoke() {
            log('üö® Simulating revoked certificate attack...');
            try {
                const response = await fetch('/api/attack/revoke', { method: 'POST' });
                const data = await response.json();
                updateStatus('attack', `üõ°Ô∏è Attack blocked: ${data.message}`, 'success');
                log(`Revoked certificate attack blocked: ${data.message}`, 'success');
                updateMetrics();
            } catch (error) {
                log(`Attack simulation error: ${error.message}`, 'error');
            }
        }
        
        async function updateMetrics() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('balance').textContent = `$${data.balance || 0}`;
                
                if (data.delegation) {
                    document.getElementById('spent').textContent = `$${data.delegation.spent}`;
                    document.getElementById('remaining').textContent = `$${data.delegation.remaining}`;
                }
                
                const agentStatus = data.agent_revoked ? 'üö´ Revoked' : 
                                  data.agent_registered ? '‚úÖ Active' : '‚ùå Not Registered';
                document.getElementById('agent-status').textContent = agentStatus;
                
            } catch (error) {
                log(`Failed to update metrics: ${error.message}`, 'error');
            }
        }
        
        async function resetDemo() {
            log('üîÑ Resetting demo...');
            try {
                const response = await fetch('/api/reset', { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Reset UI
                    currentPhase = 0;
                    document.querySelectorAll('.phase').forEach(phase => {
                        phase.classList.remove('completed', 'error');
                    });
                    document.querySelectorAll('.status').forEach(status => {
                        status.style.display = 'none';
                    });
                    document.querySelectorAll('button').forEach(btn => {
                        btn.disabled = btn.textContent !== 'Register Merchant' && !btn.classList.contains('reset-btn');
                    });
                    
                    // Reset metrics
                    document.getElementById('balance').textContent = '$0';
                    document.getElementById('spent').textContent = '$0';
                    document.getElementById('remaining').textContent = '$0';
                    document.getElementById('agent-status').textContent = '‚ùå';
                    
                    // Clear log
                    document.getElementById('log').innerHTML = '<div class="log-entry log-info">üöÄ A2P Protocol Demo reset. Start with Phase 1: Merchant Registration</div>';
                    
                    log('Demo reset successfully', 'success');
                }
            } catch (error) {
                log(`Reset failed: ${error.message}`, 'error');
            }
        }
        
        // Initialize metrics on page load
        updateMetrics();
    </script>
</body>
</html>